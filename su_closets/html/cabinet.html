<!DOCTYPE html>
<html>
<head>
  <link href="vendor/Semantic-UI/semantic.min.css" rel="stylesheet">
  <script src="vendor/jquery.js"></script>
  <script src="vendor/Semantic-UI/semantic.min.js"></script>
  <script src="vendor/vue.js"></script>
  <link href="style.css" rel="stylesheet">
</head>
<body>
  <div id="app">
    <template v-if="cabinet">
      <div class="ui padded grid">
        <div class="centered column row">
          <h1 class="ui dividing header">Build Cabinet</h1>
        </div>
      </div>
        <div class="ui top attached tabular menu">
          <a class="item" :class="{ active: activeTabs.first }" @click="switchTab('first')">Lower</a>
          <a class="item" :class="{ active: activeTabs.second }" @click="switchTab('second')">Upper</a>
          <a class="item" :class="{ active: activeTabs.third }" @click="switchTab('third')">Blind</a>
        </div>
        <div class="ui bottom attached tab segment" :class="{ active: activeTabs.first }">

            <form class="ui form">
              <div class="ui padded grid three column">

                <div class="row">
                  <div class="column">
                    <div class="fluid field">
                      <label>Width</label>
                      <input placeholder="Width"
                              v-model="cabinet.width">
                    </div>
                  </div>

                  <div class="column">
                    <div class="fluid field">
                      <label>Depth</label>
                      <input placeholder="Depth"
                              v-model="cabinet.depth">
                    </div>
                  </div>

                  <div class="column">
                    <div class="fluid field">
                      <label>Height</label>
                      <input placeholder="Height"
                              v-model="cabinet.height">
                    </div>
                  </div>
                </div>

                <div class="row">
                  <div class="column">
                    <div class="fluid field">
                      <label>Material Thickness</label>
                      <input placeholder="Thickness"
                              v-model="cabinet.thickness">
                    </div>
                  </div>

                  <div class="column">
                    <div class="fluid field">
                      <label>Doors</label>
                      <div class="ui fluid buttons">
                          <template v-for="n in 3">
                              <div class="ui button checkbox" v-bind:class="{ 'active': cabinet.doors == n-1 }">
                                <input type="radio" v-bind:value="n-1" v-model="cabinet.doors">
                                <label>{{ n-1 }}</label>
                              </div>
                          </template>
                      </div>
                    </div>
                  </div>

                  <div class="column">
                    <div class="fluid field">
                      <label>Drawers</label>
                      <div class="ui fluid mini buttons">
                          <template v-for="n in 5">
                              <div class="ui button checkbox" v-bind:class="{ 'active': cabinet.drawers == n-1 }">
                                <input type="radio" v-bind:value="n-1" v-model="cabinet.drawers">
                                <label>{{ n-1 }}</label>
                              </div>
                          </template>
                      </div>
                    </div>
                  </div>
                </div>

              </div> <!-- grid -->

              <div style="padding: 1em;">
                <div class="ui primary button" v-on:click="buildCabinet">Build</div>
                <div class="ui primary button" v-on:click="buildBlind">Build Blind</div>
                <div class="ui button" v-on:click="cancel">Cancel</div>
                <div class="ui negative button" v-on:click="unbuild" v-bind:class="{'hidden': !isBuilt}">Undo</div>

              </div>

              <div class="centered sixteen wide column">
                <div class="ui negative message" v-bind:class="{'hidden' : !hasError}">
                  <i class="close icon" v-on:click="closeError"></i>
                  <div class="header">An error occured.</div>
                  <p>
                    <template v-for="error in errorMessages">
                      {{ error }}<br/>
                    </template>
                  </p>
                </div>
              </div>
            </form>
        </div>
        <div class="ui bottom attached tab segment" :class="{ active: activeTabs.second }">
          Coming soon...
        </div>
        <div class="ui bottom attached tab segment" :class="{ active: activeTabs.third }">
          Coming soon...
        </div>
    </template>

    <template v-else>
      <h2>Error loading data</h2>
    </template>
  </div><!-- app -->
  <script>

    var app = new Vue({
      el: '#app',
      data: {
        cabinet: null,
        isBuilt: false,
        errorMessages: [],
        hasError: false,
        activeTabs: {
            first: true,
            second: false,
            third: false,
        }
      },
      methods: {
        buildCabinet: function() {
          this.closeError();
          sketchup.buildCabinet(this.cabinet);
        },
        buildBlind: function() {
          this.closeError();
          sketchup.buildBlind(this.cabinet);
        },
        cancel: function() {
            console.log(app.hasError);
          sketchup.cancel();
        },
        unbuild: function() {
          this.closeError();
          sketchup.unbuildCabinet();
          this.isBuilt = false;
        },
        closeError: function() {
          this.errorMessages = [];
          this.hasError = false;
        },
        switchTab: function(tab) {
            Object.keys(this.activeTabs).forEach(v => this.activeTabs[v] = false);
            this.activeTabs[tab] = true;
        }
      },
      mounted: function() {
        sketchup.ready();
      },
    });
    function updateParams(update) {
      app.cabinet.width = update.width;
      app.cabinet.height = update.height;
    };
    function updateError(messages) {
      app.errorMessages = messages;
      app.hasError = true;
    };
    function success(status) {
      app.isBuilt = status;
    };
    function updateCabinet(params) {
      app.cabinet = params;
    };
  </script>
</body>
</html>
